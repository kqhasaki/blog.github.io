<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.6d254c5d4f50e7cd19b8.css" data-identity="gatsby-global-css">.modal-wrapper{align-items:center;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);background:rgba(0,0,0,.6);bottom:0;display:flex;justify-content:center;left:0;position:fixed;right:0;top:0;z-index:1000}.modal-content-wrapper::-webkit-scrollbar{width:0}.modal-content{background:var(--card-background-color);border:1px solid var(--card-background-border-color);border-radius:1rem;padding:1.5rem;position:relative;width:40rem}.modal-content-wrapper{max-height:70vh;min-height:50vh;overflow-y:auto;width:100%}.modal-closer{cursor:pointer;font-size:1.2rem;position:absolute;right:.8rem;top:.8rem}.modal-closer:hover{color:var(--blue)}.post-card-img{border-radius:12px;bottom:0;box-shadow:0 0 2px rgba(0,0,0,.06);height:200px;left:50%;-o-object-fit:cover;object-fit:cover;position:absolute;-webkit-transform:translate(-50%) rotate(-8deg);transform:translate(-50%) rotate(-8deg);transition:.2s;width:300px}.img-line{height:120px;margin-bottom:2rem;position:relative}.post-card{align-items:center;border:1px solid var(--card-background-border-color);border-radius:1.5rem;cursor:pointer;display:flex;flex-direction:column;justify-content:center;margin:140px auto 0;max-width:45rem;padding:1.5rem 2rem;transition:.2s}.post-card:hover{box-shadow:0 0 1rem var(--card-box-shadow)}.post-card:active{box-shadow:0 0 1.5rem var(--blue)}.post-card:hover .post-card-img{-webkit-transform:translate(-50%) rotate(0deg);transform:translate(-50%) rotate(0deg)}.post-card h2:after{background:var(--blue);content:"";display:block;height:2px;margin-left:auto;margin-right:auto;margin-top:10px;width:60px}.post-card-meta{background-color:var(--card-background-color);border:1px solid var(--card-background-border-color);border-radius:.5rem;font-size:.9rem;font-weight:300;margin:1rem 0 0;padding:.5rem 1rem}@media (max-width:500px){.post-card{padding:1.5rem .8rem}}.item-list{align-items:center;border-left:3px solid var(--blue);display:flex;flex-direction:column;justify-content:center;margin:0 auto 0 1rem}.item-list .item{margin:0;padding:1rem;position:relative;width:100%}.item:before{background-color:var(--blue);border-radius:50%;content:"";height:.8rem;left:-.5rem;position:absolute;top:2rem;transition:.2s;width:.8rem}.item:hover:before{-webkit-transform:scale(1.2);transform:scale(1.2)}.item-list .item-label{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;font-size:15px;font-weight:400}.item-list .item-content{padding-top:.5rem}.homepage-title{font-weight:700;margin:2rem 0 1rem}.item a{transition:.3s}.item a:hover{color:var(--font-color-highlight)}.messager{background-color:var(--background-color);border:1px solid var(--card-background-border-color);border-radius:.5rem;box-shadow:0 0 .8rem var(--card-box-shadow);left:0;margin-left:auto;margin-right:auto;max-width:200px;padding:.5rem 1rem;position:fixed;right:0;text-align:center;top:1rem;-webkit-transform:scale(.2);transform:scale(.2);transition:.2s;z-index:999}.avatar{align-items:center;display:flex;flex-direction:row;height:8rem;justify-content:center}.avatar>img{border-radius:50%;box-shadow:0 0 4px rgba(0,0,0,.1);max-height:100%;-o-object-fit:cover;object-fit:cover;-o-object-position:center center;object-position:center center;opacity:1;padding:.5rem;transition:none 0s ease 0s}.footer{border-top:1px solid var(--card-background-border-color);color:var(--font-color);display:flex;flex-direction:row;font-size:13px;justify-content:space-evenly;margin-top:10rem;padding:2rem 0 8rem;position:relative;-webkit-user-select:none;-ms-user-select:none;user-select:none}.footer .wrapper{align-items:flex-start;display:flex;flex-direction:column;font-family:sans-serif;padding-left:.5rem;padding-right:1rem;width:50%}h3,ul{width:100%}h3{color:var(--font-color);margin-bottom:8px}.footer p{line-height:1.2rem;margin:0;padding:.5rem 0}.footer span{color:var(--font-color);cursor:pointer;margin-right:12px}.wrapper li{padding:4px 0}.footer span:hover{color:var(--font-color-highlight)}@media (max-width:600px){.footer{flex-direction:column}.footer .wrapper{margin-bottom:1rem;width:100%}}:root{--deckgo-highlight-code-font-family:Menlo,Monaco,Consolas}@media (prefers-color-scheme:dark){body{--blue:#02bbff;--background-color:#202124;--background-color-transparent:rgba(0,0,0,.9);--font-color:#bdc1c6;--font-color-header:#eaeaea;--font-color-highlight:#efefef;--btn-color:#333;--card-background-color:#222;--quote-background-color:#242424;--font-color-quote:#bdcbdc;--card-background-border-color:#2a2a2a;--card-box-shadow:#333;--code-font-color:#e0e0e0;--code-background-color:hsla(0,0%,39%,.2);--code-border-color:hsla(0,0%,39%,.2);--code-block-background:rgba(0,0,0,.1);--navigator-hover-color:hsla(0,0%,100%,.1);--navigator-border-color:#222}}@media (prefers-color-scheme:light){body{--blue:#02bbff;--background-color:#fff;--background-color-transparent:hsla(0,0%,100%,.9);--font-color:#3c4043;--font-color-header:#3c4043;--btn-color:#fff;--card-background-color:#efefef;--card-background-border-color:#efefef;--quote-background-color:#eaf8ff;--font-color-highlight:#000;--font-color-quote:#4e7182;--card-box-shadow:rgba(0,0,0,.1);--code-font-color:#444;--code-background-color:rgba(255,229,100,.2);--code-border-color:rgba(255,229,100,.2);--code-block-background:#313131;--navigator-hover-color:rgba(0,0,0,.08);--navigator-border-color:#ddd}}.dark{--blue:#02bbff;--background-color:#202124;--background-color-transparent:rgba(0,0,0,.9);--font-color:#bdc1c6;--font-color-header:#eaeaea;--font-color-highlight:#efefef;--btn-color:#333;--card-background-color:#222;--quote-background-color:#242424;--font-color-quote:#bdcbdc;--card-background-border-color:#2a2a2a;--card-box-shadow:#333;--code-font-color:#e0e0e0;--code-background-color:hsla(0,0%,39%,.2);--code-border-color:hsla(0,0%,39%,.2);--code-block-background:rgba(0,0,0,.1);--navigator-hover-color:hsla(0,0%,100%,.1);--navigator-border-color:#222}.light{--blue:#02bbff;--background-color:#fff;--background-color-transparent:hsla(0,0%,100%,.9);--font-color:#3c4043;--font-color-header:#3c4043;--btn-color:#fff;--card-background-color:#efefef;--card-background-border-color:#efefef;--quote-background-color:#eaf8ff;--font-color-highlight:#000;--font-color-quote:#4e7182;--card-box-shadow:rgba(0,0,0,.1);--code-font-color:#444;--code-background-color:rgba(255,229,100,.2);--code-border-color:rgba(255,229,100,.2);--code-block-background:#313131;--navigator-hover-color:rgba(0,0,0,.08);--navigator-border-color:#ddd}body,html{background-color:var(--background-color);color:var(--font-color);font-family:Arial,Helvetica,sans-serif}a{color:inherit;text-decoration:none}*{-webkit-tap-highlight-color:rgba(0,0,0,0);border:none;box-sizing:border-box;list-style-type:none;margin:0;padding:0}ol{margin:.7rem 0}ol li{list-style-type:decimal;margin:.4rem 0 .4rem 2rem}p{-webkit-margin-before:1em;-webkit-margin-after:1em;-webkit-margin-start:0;-webkit-margin-end:0;display:block;line-height:1.7rem;margin-block-end:1em;margin-block-start:1em;margin-bottom:.7rem;margin-inline-end:0;margin-inline-start:0;margin-top:.7rem}::selection{background-color:var(--blue);color:#fff}body{word-wrap:break-word;font-kerning:normal;margin:0;padding:0}header{align-items:center;display:flex;flex-direction:row;justify-content:space-around;padding-bottom:0}header>.route-link{margin:0 1rem}header img{box-shadow:0 0 .2rem rgba(0,0,0,.5)}.base-wrapper{margin-left:auto;margin-right:auto;max-width:48rem;min-height:100%;padding:2.625rem 1.3125rem}.nav-link{align-items:center;color:var(--font-color);cursor:pointer;display:flex;flex-direction:column;font-size:2rem;justify-content:center;margin:0 1rem;min-width:3rem}.nav-link>img{border-radius:50%;height:2rem;-webkit-transform:scale(1.2);transform:scale(1.2)}.nav-link:hover{color:var(--blue);text-decoration:none}.nav-link:hover .link-label{-webkit-transform:scaleY(1);transform:scaleY(1)}.nav-link .link-label{bottom:-24px;display:block;font-size:.9rem;padding-top:6px;text-align:center;-webkit-transform:scaleY(0);transform:scaleY(0);transition:.2s;width:8rem}.link-active{color:var(--blue)}.article-body .article-title{font-size:2rem;font-weight:500;margin-bottom:1.5rem;text-align:center}.article-body strong{color:var(--font-color-highlight)}.article-meta{font-size:.9rem;margin:1rem auto 1.5rem;text-align:center}.article-meta>span{background-color:var(--card-background-color);border-radius:.5rem;font-weight:lighter;padding:.5rem 1rem}.article-body h1,h2,h3{cursor:pointer}.article-body h1{color:var(--font-color-header);font-size:2rem;font-weight:400;margin-bottom:1.8rem;margin-top:1.8rem}.article-body h1 code{font-size:1.6rem}.article-body h2{color:var(--font-color-header);font-weight:400;margin-bottom:1.6rem;margin-top:1.5rem}.article-body h2 code{font-size:1.2rem}.article-body h3{color:var(--font-color-header);font-weight:400;line-height:1.8;margin-bottom:.5rem;margin-top:1.5rem}.article-body h3 code{font-size:1.1rem}.article-body h4{color:var(--font-color-header);font-weight:300;margin-bottom:1rem;margin-top:1.5rem}.article-body h4 code{font-size:1rem}.article-body h1:first-child{border-radius:.5rem}.article-body h1:not(:first-child):before{margin-bottom:.5rem}.article-body h1:not(:first-child):before,.article-body h2:before{background:var(--blue);content:"";display:block;height:2px;width:70px}.article-body h2:before{margin-bottom:.3rem}.article-body h3:before{background:var(--blue);content:"";display:block;height:1.5px;margin-top:.1rem;width:54px}.article-body code{background-color:var(--code-background-color);border:1px solid var(--code-border-color);border-radius:4px;color:var(--code-font-color);font-family:Menlo,Monaco,Consolas,monospace;font-size:14px;margin:0 2px;padding:1px 4px}.article-body blockquote{background-color:var(--quote-background-color);border-left:2px solid var(--blue);border-radius:0 .5rem .5rem 0;color:var(--font-color-quote);margin-top:1rem;padding:1rem}.article-body blockquote code{color:var(--font-color-highlight)}.article-body .article-cover{border-radius:16px;box-shadow:0 0 1px rgba(0,0,0,.1);width:80%}.article-body .article-cover,.article-body img{display:block;margin:0 auto;min-width:330px;-o-object-fit:cover;object-fit:cover}.article-body img{border-radius:12px;width:100%}.article-body ul{margin:.7rem 0}.article-body ul li{list-style-type:disc;margin:.4rem 0 .4rem 2rem}.article-body a{color:#189fff}a:hover{text-decoration:underline}.article-body a:after{content:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMSIgaGVpZ2h0PSIxMSIgY2xhc3M9InByZWZpeF9faWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCI+PHBhdGggZmlsbD0iIzE4OWZmZiIgZD0iTTkyNC40MDIgMTAyMy4wNjhILjY4Vjk5LjM0NUg0NjIuNTR2OTguOTFIOTkuNTk3VjkyNC4xNWg3MjUuODk2VjU2MS4yMDdoOTguOTF6Ii8+PHBhdGggZmlsbD0iIzE4OWZmZiIgZD0ibTkzMC44MDUgMjIuOTc3IDY5Ljk2NiA2OS45NjYtNDUzLjQ5MyA0NTMuNDkyLTY5Ljk2NS02OS45MDF6Ii8+PHBhdGggZmlsbD0iIzE4OWZmZiIgZD0iTTEwMjIuNDY0IDMwNC4wM2gtOTguOTE3Vjk5LjM0NUg3MDkuMjMxVi40MjhoMzEzLjIzM3oiLz48L3N2Zz4=);padding-left:2px}.article-body table{word-wrap:normal;border-collapse:collapse;table-layout:fixed;width:100%}th{background-color:rgba(0,0,0,.06);text-align:center}td{background-color:hsla(0,0%,100%,.01);font-weight:300}table,td,th{border:1px solid rgba(0,0,0,.1);overflow:auto;padding:.5rem}.theme-changer{border-radius:50%;bottom:1rem;cursor:pointer;position:fixed;right:1rem}.theme-changer img{background-color:var(--background-color);border:1px solid var(--card-background-border-color);border-radius:50%;height:30px;padding:6px;width:30px}deckgo-highlight-code{background-color:var(--code-block-background);border-radius:.5rem;box-shadow:none!important;cursor:pointer;font-size:14px;margin-top:1rem;position:relative;-webkit-user-select:none;-ms-user-select:none;user-select:none}@media (min-width:500px){deckgo-highlight-code:after{content:"双击复制";font-size:12px;height:2rem;opacity:0;position:absolute;right:1rem;text-align:center;top:1rem;transition:.4s;width:3rem}deckgo-highlight-code:hover:after{opacity:1}}.progresser{background-color:var(--background-color);border:1px solid var(--card-background-border-color);border-radius:50%;color:var(--font-color);cursor:pointer;font-family:Courier New,Courier,monospace;font-size:13px;font-weight:lighter;height:30px;line-height:29px;position:fixed;right:1rem;text-align:center;top:1rem;-webkit-user-select:none;-ms-user-select:none;user-select:none;width:30px;z-index:999}.progresser:after{background-color:var(--quote-background-color);border-radius:50%;content:"";opacity:0;transition:.2s}.progresser:after,.progresser:hover:after{bottom:0;left:0;position:absolute;right:0;top:0}.progresser:hover:after{content:"up";opacity:1}.table-of-content{background-color:var(--background-color);border-left:1px solid var(--card-background-border-color);font-size:15px;height:95%;left:50%;overflow-y:auto;padding:1.5rem 1.5rem 3.5rem;position:fixed;top:50%;-webkit-transform:translateX(25rem) translateY(-50%);transform:translateX(25rem) translateY(-50%);-webkit-user-select:none;-ms-user-select:none;user-select:none;width:280px}@media (max-width:810px){.table-of-content{display:none}}.table-of-content::-webkit-scrollbar{display:none}.table-of-content p{cursor:pointer;margin:0;overflow-x:hidden;text-overflow:ellipsis;white-space:nowrap;width:100%}.table-of-content .topHeader{color:var(--blue)!important}.table-of-content p:hover{color:var(--blue)}p.header-level-h1{margin-top:.5rem}p.header-level-h2{font-size:14px;padding-left:1rem}p.header-level-h3{font-size:13px;padding-left:2rem}.article-navigator{background-color:var(--background-color);border-right:1px solid var(--card-background-border-color);font-size:15px;height:95%;overflow-y:auto;padding:1.5rem 1.5rem 3.5rem;position:fixed;right:50%;top:50%;-webkit-transform:translateX(-25rem) translateY(-50%);transform:translateX(-25rem) translateY(-50%);-webkit-user-select:none;-ms-user-select:none;user-select:none;width:280px;z-index:999}.article-navigator .article-navigator-toggler{cursor:pointer;font-size:1.3rem;height:2rem;line-height:2rem;position:absolute;right:0;top:1rem;visibility:hidden;width:2rem}.article-navigator .article-navigator-toggler:hover{color:var(--blue)}@media (max-width:810px){.article-navigator{-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);background-color:var(--background-color-transparent);border:none;display:none;height:100%;left:0;padding:0;-webkit-transform:translateX(0) translateY(-50%);transform:translateX(0) translateY(-50%);width:100vw}.article-navigator h4{font-size:1.2rem!important;margin-top:1rem!important;padding-left:1rem;padding-right:1rem}.article-navigator p{border-bottom:1px solid var(--navigator-border-color);font-size:1rem!important;line-height:2.8rem!important;padding-left:2rem!important;padding-right:2rem!important;transition:background .3s}.article-navigator p:hover{background:var(--navigator-hover-color)}.navigator-switch{display:block}.article-navigator .article-navigator-toggler{visibility:visible}}.article-navigator h4{font-size:15px;margin-bottom:.5rem;margin-top:1rem}.article-navigator h4:first-child{margin-top:0}.navigator-switch{background-color:var(--background-color);border:1px solid var(--card-background-border-color);border-radius:50%;color:var(--font-color);cursor:pointer;display:none;font-size:.8rem;height:30px;left:1rem;line-height:29px;position:fixed;text-align:center;top:1rem;width:30px;z-index:999}.article-navigator p{cursor:pointer;font-size:14px;margin:0;overflow-x:hidden;padding-left:.5rem;text-overflow:ellipsis;white-space:nowrap;width:100%}.article-navigator p:hover,.highlighted-navigator-item{color:var(--blue)}</style><meta name="generator" content="Gatsby 4.4.0"/><link as="script" rel="preload" href="/webpack-runtime-2728ac9e468d19f28ba9.js"/><link as="script" rel="preload" href="/framework-f27b074ecebec0f1dbc4.js"/><link as="script" rel="preload" href="/app-e932af7f93db5f1d5fc7.js"/><link as="script" rel="preload" href="/cb1608f2-31c90b1bb67e245cb538.js"/><link as="script" rel="preload" href="/a9a7754c-992c6b2080a7db331a45.js"/><link as="script" rel="preload" href="/commons-9cb01ae01e0bbefcc23a.js"/><link as="script" rel="preload" href="/component---src-pages-articles-mdx-slug-js-9153719145713b5d4a70.js"/><link as="fetch" rel="preload" href="/page-data/articles/redbook-series/redbook-chapter20/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2757060725.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3605573801.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="base-wrapper"><title>Louis K - Software Engineer</title><header><a class="nav-link" href="/nonTech"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="book" class="svg-inline--fa fa-book " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M448 336v-288C448 21.49 426.5 0 400 0H96C42.98 0 0 42.98 0 96v320c0 53.02 42.98 96 96 96h320c17.67 0 32-14.33 32-31.1c0-11.72-6.607-21.52-16-27.1v-81.36C441.8 362.8 448 350.2 448 336zM143.1 128h192C344.8 128 352 135.2 352 144C352 152.8 344.8 160 336 160H143.1C135.2 160 128 152.8 128 144C128 135.2 135.2 128 143.1 128zM143.1 192h192C344.8 192 352 199.2 352 208C352 216.8 344.8 224 336 224H143.1C135.2 224 128 216.8 128 208C128 199.2 135.2 192 143.1 192zM384 448H96c-17.67 0-32-14.33-32-32c0-17.67 14.33-32 32-32h288V448z"></path></svg><span class="link-label">杂谈文章</span></a><a class="nav-link" href="/"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="laptop-code" class="svg-inline--fa fa-laptop-code " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M128 96h384v256h64V80C576 53.63 554.4 32 528 32h-416C85.63 32 64 53.63 64 80V352h64V96zM624 384h-608C7.25 384 0 391.3 0 400V416c0 35.25 28.75 64 64 64h512c35.25 0 64-28.75 64-64v-16C640 391.3 632.8 384 624 384zM365.9 286.2C369.8 290.1 374.9 292 380 292s10.23-1.938 14.14-5.844l48-48c7.812-7.813 7.812-20.5 0-28.31l-48-48c-7.812-7.813-20.47-7.813-28.28 0c-7.812 7.813-7.812 20.5 0 28.31l33.86 33.84l-33.86 33.84C358 265.7 358 278.4 365.9 286.2zM274.1 161.9c-7.812-7.813-20.47-7.813-28.28 0l-48 48c-7.812 7.813-7.812 20.5 0 28.31l48 48C249.8 290.1 254.9 292 260 292s10.23-1.938 14.14-5.844c7.812-7.813 7.812-20.5 0-28.31L240.3 224l33.86-33.84C281.1 182.4 281.1 169.7 274.1 161.9z"></path></svg><span class="link-label">技术文章</span></a><div class="nav-link"><img alt="avatar" src="/static/avatar-427bcc9e4a03334af5649168991c08f0.png"/><span class="link-label">关于作者</span></div></header><main><div class="progresser">0</div><div class="article-body"><h1 class="article-title">红宝书系列（二十）JavaScript API</h1><p class="article-meta"><span><span role="img" aria-label="field-time" class="anticon anticon-field-time"><svg viewBox="64 64 896 896" focusable="false" data-icon="field-time" width="1em" height="1em" fill="currentColor" aria-hidden="true"><defs><style></style></defs><path d="M945 412H689c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h256c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zM811 548H689c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h122c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zM477.3 322.5H434c-6.2 0-11.2 5-11.2 11.2v248c0 3.6 1.7 6.9 4.6 9l148.9 108.6c5 3.6 12 2.6 15.6-2.4l25.7-35.1v-.1c3.6-5 2.5-12-2.5-15.6l-126.7-91.6V333.7c.1-6.2-5-11.2-11.1-11.2z"></path><path d="M804.8 673.9H747c-5.6 0-10.9 2.9-13.9 7.7a321 321 0 01-44.5 55.7 317.17 317.17 0 01-101.3 68.3c-39.3 16.6-81 25-124 25-43.1 0-84.8-8.4-124-25-37.9-16-72-39-101.3-68.3s-52.3-63.4-68.3-101.3c-16.6-39.2-25-80.9-25-124 0-43.1 8.4-84.7 25-124 16-37.9 39-72 68.3-101.3 29.3-29.3 63.4-52.3 101.3-68.3 39.2-16.6 81-25 124-25 43.1 0 84.8 8.4 124 25 37.9 16 72 39 101.3 68.3a321 321 0 0144.5 55.7c3 4.8 8.3 7.7 13.9 7.7h57.8c6.9 0 11.3-7.2 8.2-13.3-65.2-129.7-197.4-214-345-215.7-216.1-2.7-395.6 174.2-396 390.1C71.6 727.5 246.9 903 463.2 903c149.5 0 283.9-84.6 349.8-215.8a9.18 9.18 0 00-8.2-13.3z"></path></svg></span> <!-- -->2022-03-10<!-- --> | <span role="img" aria-label="read" class="anticon anticon-read"><svg viewBox="64 64 896 896" focusable="false" data-icon="read" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M928 161H699.2c-49.1 0-97.1 14.1-138.4 40.7L512 233l-48.8-31.3A255.2 255.2 0 00324.8 161H96c-17.7 0-32 14.3-32 32v568c0 17.7 14.3 32 32 32h228.8c49.1 0 97.1 14.1 138.4 40.7l44.4 28.6c1.3.8 2.8 1.3 4.3 1.3s3-.4 4.3-1.3l44.4-28.6C602 807.1 650.1 793 699.2 793H928c17.7 0 32-14.3 32-32V193c0-17.7-14.3-32-32-32zM324.8 721H136V233h188.8c35.4 0 69.8 10.1 99.5 29.2l48.8 31.3 6.9 4.5v462c-47.6-25.6-100.8-39-155.2-39zm563.2 0H699.2c-54.4 0-107.6 13.4-155.2 39V298l6.9-4.5 48.8-31.3c29.7-19.1 64.1-29.2 99.5-29.2H888v488zM396.9 361H211.1c-3.9 0-7.1 3.4-7.1 7.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c.1-4.1-3.1-7.5-7-7.5zm223.1 7.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c0-4.1-3.2-7.5-7.1-7.5H627.1c-3.9 0-7.1 3.4-7.1 7.5zM396.9 501H211.1c-3.9 0-7.1 3.4-7.1 7.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c.1-4.1-3.1-7.5-7-7.5zm416 0H627.1c-3.9 0-7.1 3.4-7.1 7.5v45c0 4.1 3.2 7.5 7.1 7.5h185.7c3.9 0 7.1-3.4 7.1-7.5v-45c.1-4.1-3.1-7.5-7-7.5z"></path></svg></span> <!-- -->5000<!-- -->words <!-- -->18<!-- -->min</span></p><img class="article-cover" src="https://tva1.sinaimg.cn/large/008i3skNgy1gy6bw9bv2hj30jg0oo40x.jpg" alt="https://tva1.sinaimg.cn/large/008i3skNgy1gy6bw9bv2hj30jg0oo40x.jpg"/><p>随着 Web 浏览器能力的增加，其复杂性也在迅速增加。从很多方面来看，现代 Web 浏览器已经成为构建于诸多规范之上、集不同 API 于一身的“瑞士军刀”。浏览器规范的生态在某种程度上是混乱而无序的。一些规范如 HTML5，定义了一批增强已有标准的 API 和浏览器特性。而另一些规范如 Web Cryptography API 和 Notifications API，只为一个特性定义了一个 API。不同浏览器实现这些新 API 的情况也不同，有的会实现其中一部分，有的则干脆尚未实现。</p><p>最终，是否使用这些比较新的 API 还是要看项目是支持更多浏览器，还是要采用更多现代特性。有些 API 可以使用腻子脚本（polyfill）来模拟，但是腻子脚本通常会带来性能问题，此外也会增加网站 JavaScript 代码的体积。</p><p>Web API 的数量之多令人难以置信。本章要介绍的 API 仅限于与大多数开发者有关、已经得到多个浏览器支持的部分。</p><h1>Atomics 和<code>SharedArrayBuffer</code></h1><p>多个上下文访问<code>SharedArrayBuffer</code>时，如果同时对缓冲区执行操作，就可能出现资源争用问题。Atomics API 通过强制同一时刻只能对缓冲区执行一个操作，可以让多个上下文安全地读写一个<code>SharedArrayBuffer</code>。Atomics API 是 ES2017 中定义的。</p><p>仔细研究会发现 Atomics API 非常像一个简化版的指令集架构（ISA），这并非意外。原子操作的本质会排斥操作系统或计算机硬件通常会自动执行的优化（例如指令重新排序）。原子操作也让并发访问内存变得不可能，如果应用不当就可能导致程序执行变慢。因此，Atomics API 的设计初衷是在最少但很稳定的原子行为基础之上，构建复杂的多线程 JavaScript 程序。</p><h2><code>SharedArrayBuffer</code></h2><p><code>SharedArrayBuffer</code>和<code>ArrayBuffer</code>具有同样的 API。二者的主要区别是<code>ArrayBuffer</code>必须在不同的执行上下文之间切换，<code>SharedArrayBuffer</code>则可以被任意多个执行上下文同时使用。</p><p>在多个执行上下文间共享内存意味着并发线程操作成为了可能。传统 JavaScript 操作对于并发内存访问导致的资源争用没有提供保护。下面的例子演示了 4 个专用工作线程访问同一个<code>SharedArrayBuffer</code>导致的资源争用问题：</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const workerScript = `
	self.onmessage = ({data}) =&gt; {
		const view = new Unit32Array(data)
		// 执行1000，000次加操作
		for (let i = 0; i &lt; 1e6; i++) {
			// 线程不加安全操作会导致资源争用
			view[0] += 1
		}
		self.postMessage(null)
	}
`

const workerScriptBlobUrl = URL.createObjectURL(new Blob([workerScript]))

// 创建容量为4的工作线程池
const workers = []
for (let i = 0; i &lt; 4; i++) {
  workers.push(new Worker(workerScriptBlobUrl))
}
// 在最后一个工作线程完成后打印出最终值
let responseCount = 0
for (const worker of workers) {
  worker.onmessage = () =&gt; {
    if (++responseCount === workers.length) {
      console.log(`Final buffer value: ${view[0]}`)
    }
  }
}

// 初始化SharedArrayBuffer
const sharedArrayBuffer = new SharedArrayBuffer(4)
const view = new Unit32Array(sharedArrayBuffer)
view[0] = 1

// 把SharedArrayBuffer发送到每个工作线程
for (const worker of workers) {
  worker.postMessage(sharedArrayBuffer)
}

// 期待的结果为4000001，结果是不符合的
// Final buffer value: 2145106</code>
        </deckgo-highlight-code><p>为了解决这个问题，Atomics API 应运而生。Atomics API 可以保证<code>SharedArrayBuffer</code>上的 JavaScript 操作是线程安全的。</p><h2>原子操作基础</h2><p>任何全局上下文中都有<code>Atomics</code>对象，这个对象上暴露了用于执行线程安全操作的一套静态方法，其中多数方法以一个<code>TypedArray</code>实例（一个<code>SharedArrayBuffer</code>的引用）作为第一个参数，以相关操作数作为后续参数。</p><h3>算术及位操作方法</h3><p>Atomics API 提供了一套简单的方法用以执行就地修改操作。在 ECMA 规范中，这些方法被定义为<code>AtomicReadModifyWrite</code>操作。在底层，这些方法都会从<code>SharedArrayBuffer</code>中某个位置读取值，然后执行算术或位操作，最后再把计算结果写回相同的位置。这些操作的原子本质意味着上述读取、修改、写回操作会按照顺序执行，不会被其他线程中断。</p><p>下面代码演示了所有算术方法：</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">// 创建大小为1的缓冲区
const sharedArrayBuffer = new SharedArrayBuffer(1)

// 基于缓冲创建Unit8Array
const typedArray = new Unit8Array(sharedArrayBuffer)

// 所有ArrayBuffer全都初始化为0
console.log(typedArray) // Unit8Array[0]

const index = 0
const increment = 5

// 对索引0处的值执行原子加5
Atomics.add(typedArray, index, increment)

console.log(typedArray) // Unit8Array[5]

// 对索引0处的值执行原子减5
Atomics.sub(typedArray, index, increment)

console.log(typedArray) // Unit8Array[0]</code>
        </deckgo-highlight-code><p>下面代码演示了所有位方法：</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const sharedArrayBuffer = new SharedArrayBuffer(1)

const typedArray = new Unit8Array(sharedArrayBuffer)

console.log(typedArray) // Unit8Array[0]

const index = 0

// 对索引0处的值执行原子或0b1111
Atomics.or(typedArray, index, 0b1111)

console.log(typedArray) // Unit8Array[15]

// 对索引0处的值执行原子与0b1111
Atomics.and(typedArray, index, 0b1111)

console.log(typedArray) // Unit8Array[12]

// 对索引0处的值执行原子异或0b1111
Atomics.xor(typedArray, index, 0b1111)

console.log(typedArray) // Unit8Array[3]</code>
        </deckgo-highlight-code><h3>原子读/写</h3><p>浏览器的 JavaScript 编译器和 CPU 架构本身都有权限重排指令以提升执行效率。正常情况下，JavaScript 的单线程环境是随时可以进行这种优化的。但多线程留下的指令重排可能导致资源争用，而且极难拍错。</p><p>Atomics 通过两种主要方式解决了这个问题。</p><ul><li>所有原子指令相互之间的顺序永远不会重排</li><li>使用原子读或者原子写保证所有指令（包括原子和非原子指令）都不会相对原子读/写重新排序。这意味着位于原子读/写之前的所有指令会在原子读/写发生前完成，而位于原子读/写之后的所有指令会在原子读/写完成后才会开始。</li></ul><p>除了读写缓冲区的值，<code>Atomics.load()</code>和<code>Atomics.store()</code>还可以构建“代码围栏”。JavaScript 引擎保证非原子指令可以相对于<code>load()</code>或<code>store()</code>本地重排。但这个重排不会侵犯原子读/写的边界。</p><h3>原子交换</h3><p>为了保证连续、不间断的先读后写，Atomics API 提供了两种方法： <code>exchange()</code>和<code>compareExchange()</code>。<code>Atomics.exchange()</code>执行简单的交换，以保证其他线程不会中断值的交换：</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const sharedArrayBuffer = new SharedArrayBuffer(4)
const view = new Unit32Array(sharedArrayBuffer)

Atomics.store(view, 0, 3)

console.log(Atomics.exchange(view, 0, 4)) // 3

console.log(Atomics.load(view, 0)) // 4</code>
        </deckgo-highlight-code><p>在多线程程序中，一个线程可能<strong>只希望</strong>在上次读取某个值之后没有其他线程修改该值的情况下才对共享缓冲区执行写操作。如果这个值没有被修改，这个线程就可以安全地写入更新后的值；如果这个值被修改了，那么执行写操作将会破坏其他线程计算的值。对于这种任务，Atomics API 提供了<code>compareExchange()</code>方法。这个方法只在目标索引处的值和预期值匹配时才会执行写操作。</p><h3>原子 Futex 操作与枷锁</h3><p>如果没有某种锁机制，多线程程序就无法支持复杂需求。为此，Atomics API 提供了模仿 Linux Futex（快速用户空间互斥量，fast user-space mutex）的方法。这些方法本身虽然非常简单，但是可以作为更复杂的锁机制的基本组件。</p><h1>跨上下文消息</h1><p><strong>跨文档消息</strong>，有时候简称为 XDM（cross-document messaging)，是一种在不同执行上下文（如不同工作者线程或不同源的页面）间传递信息的能力。例如<code>www.wrox.com</code>上的页面想要与包含在内嵌窗格中<code>p2p.wrox.com</code>上面的页面通信。在 XDM 之前，要以安全方式实现这种通信需要做很多工作。XDM 以安全易用的方式规范化了这个功能。</p><blockquote><p>跨上下文消息用于窗口之间或者工作线程之间通信。</p></blockquote><p>XDM 的核心是<code>postMessage()</code>方法。除了 XDM，这个方法名还在 HTML5 中很多地方用到过，但目的都是一样，都是把数据传送到另一个位置。</p><p><code>postMessage()</code>方法接收 3 个参数：消息、表示目标接收源的字符串和可选的可传输对象的数组（只与工作线程相关）。第二个参数对于安全非常重要，其可以限制浏览器交付数据的目标。下面看一个例子：</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const iframeWindow = document.getElementById(&#x27;myframe&#x27;).contentWindow

iframeWindow.postMessage(&#x27;A secret&#x27;, &#x27;http://www.wrox.com&#x27;)</code>
        </deckgo-highlight-code><p>最后一行代码尝试向内嵌窗格中发送一条消息，而且指定了源必须是<code>&quot;http://www.wrox.com&quot;</code>。如果源匹配，那么消息将会交付到内嵌窗格；否则，<code>postMessage()</code>什么也不做。这个限制可以保护信息不会因为地址改变而泄漏。如果不想知限制接收目标，则可以给<code>postMessage()</code>的第二个参数传<code>&quot;*&quot;</code>，但不推荐这么做。</p><p>接收到 XDM 消息后，<code>window</code>对象上触发<code>message</code>事件。这个事件是异步触发的，因此从消息发出到接收到消息（接收窗口触发<code>message</code>事件）可能有延迟。传给<code>onmessage</code>事件处理程序的<code>event</code>对象包含以下 3 方法重要信息：</p><ul><li><code>data</code> 作为第一个参数传递给<code>postMessage()</code>的字符串数据</li><li><code>origin</code> 发送消息的文档源，例如<code>&quot;http://ww.wrox.com&quot;</code></li><li><code>source</code> 发送消息的文档中<code>window</code>对象的代理。这个代理对象主要用于在发送一条消息的窗口中执行<code>postMessage()</code>方法。如果发送窗口有相同的源，那么这个对象应该就是<code>window</code>对象。</li></ul><p>接收消息之后验证发送窗口的源是非常重要的。与<code>postMessage()</code>的第二个参数可以保证数据不回意外地传给未知页面一样。在<code>onmessage</code>事件处理程序中检查发送窗口的源可以保证数据来自正确的地方。</p><p>大多数情况下，<code>event.source</code>是某个<code>window</code>对象的代理，而非实际的<code>window</code>对象。因此不能通过它访问所有窗口下的信息。最好只使用<code>postMessage()</code>，这个方法永远存在且可以调用。</p><p>在通过内嵌窗格加载不同的域时，使用 XDM 是非常方便的。这种方法在混搭<code>mashup</code>和社交应用中非常常用。通过使用 XDM 与内嵌窗格中的网页通信，可以保证包含页面的安全。XDM 也可以用于同源页面之间的通信。</p><h1>Encodding API</h1><p>Encoding API 主要用于实现字符串与定型数组之间的转换。规范新增了 4 个用于执行转换的全局类：<code>TextEncoder</code>、<code>TextEncoderStream</code>、<code>TextDecoder</code>和<code>TextDecoderStream</code>。</p><blockquote><p>相比于<strong>批量（bulk）</strong>的编解码，对<strong>流（stream）</strong>编解码的支持很有限。</p></blockquote><h2>文本编码</h2><p>Encoding API 提供了两种将字符串转换为定型数组二进制格式的方法：批量编码和流编码。把字符串转换为定型数组时，编码器始终使用 UTF-8。</p><h3>批量编码</h3><p>所谓<strong>批量</strong>，指的是 JavaScript 引擎会同步编码整个字符串。对于非常长的字符串，可能会花较长时间。批量编码是通过<code>TextEncoder</code>的实例完成的：</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const textEncoder = new TextEncoder()</code>
        </deckgo-highlight-code><p>这个实例上有一个<code>encode()</code>方法，该方法接收一个字符串参数，并以<code>Unit8Array</code>格式返回每个字符的 UTF-8 编码：</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const textEncoder = new TextEncoder()
const decodedText = &#x27;foo&#x27;
const encodedText = textEncoder.encode(decodedText)

console.log(encodedText) // Unit8Array(3) [102, 111, 111]</code>
        </deckgo-highlight-code><p>编码器是用于处理字符的，有些字符（例如表情符号）在最终返回的数组中可能会占据多个索引：</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const textEncoder = new TextEncoder()
const decodedText = &#x27;☺&#x27;
const encodedText = textEncoder.encode(decodedText)

console.log(encodedText) // Unit8Array(3) [226, 152, 186]</code>
        </deckgo-highlight-code><p>编码器实例还有一个<code>encodeInto()</code>方法，该方法接收一个字符串和目标<code>Unit8Array</code>，返回一个字典，该字典包含<code>read</code>和<code>written</code>属性，分别表示成功从源字符串读取了多少字符和向目标数组写入了多少字符。如果定型数组的空间不够，编码就会提前终止，返回的字典会体现这个结果。</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const textEncoder = new TextEncoder()
const fooArr = new Unit8Array(3)
const barArr = new Unit8Array(2)
const fooResult = textEncoder.encodeInto(&#x27;foo&#x27;, fooArr)
const barResult = textEncoder.encodeInto(&#x27;bar&#x27;, barArr)

console.log(foArr) // Unit8Array(3) [102, 111, 111]
console.log(fooResult) // { read: 3, written: 3 }
console.log(barArr) // Unit8Array(2) [98, 97]
console.log(barResult) // { read: 2, written: 2 }</code>
        </deckgo-highlight-code><p><code>encode()</code>要求分配一个新的<code>Unit8Array</code>，<code>encodeInto()</code>则不要。对于追求性能的应用，这个差别可能会带来显著不同。</p><blockquote><p>文本编码会始终使用 UTF-8 格式，而且必须写入<code>Unit8Array</code>实例。使用其他类型数组会导致<code>encodeInto()</code>抛出错误。</p></blockquote><h3>流编码</h3><p><code>TextEncoderStream</code>其实就是<code>TransformStream</code>形式的<code>TextEncoder</code>。将解码后的文本流通过管道输入流编码器会得到编码后文本块的流：</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">async function* chars() {
  const decodeText = &#x27;foo&#x27;
  for (const char of decodeText) {
    yield await new Promise(resolve =&gt; setTimeout(resolve, 1000, char))
  }
}

const decodedTextStream = new ReadableStream({
  async start(controller) {
    for await (let chunk of chars()) {
      controller.enqueue(chunk)
    }

    controller.close()
  },
})

const encodedTextStream = decodedTextStream.pipeThrough(new TextEncoderStream())

const readableStreamDefaultReader = encodeTextStream.getReader()(
  async function () {
    while (true) {
      const { done, value } = await readableStreamDefaultReader.read()
      if (done) {
        break
      } else {
        console.log(value)
      }
    }
  }
)()

// Unit8Array [102]
// Unit8Array [111]
// Unit8Array [111]</code>
        </deckgo-highlight-code><h2>文本解码</h2><p>Encoding API 提供了两种将定型数组转换为字符串的方式：批量解码和流解码。与编码器类不同，在将定型数组转换为字符串时，解码器支持非常多的字符串编码。默认字符编码格式是 UTF-8。</p><h3>批量解码</h3><p>所谓<strong>批量</strong>，指的是 JavaScript 引擎会同步解码整个字符串。对于非常长的字符串，可能会花较长时间。批量解码是通过<code>TextDecoder</code>的实例完成的：</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const textDecoder = new TextDecoder()</code>
        </deckgo-highlight-code><p>这个实例上有一个<code>decode()</code>方法，该方法接收一个定型数组参数，返回解码后的字符串：</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const textDecoder = new TextDecoder()
const encodedText = Uint8Array.of(102, 111, 111)
const decodedText = textDecoder.decode(encodedText)

console.log(decodedText) // foo</code>
        </deckgo-highlight-code><p>解码器不关心传入的是哪种定型数组，它只会专心解码整个二进制表示。在下面这个例子中，只包含 8 位字符的 32 位值被解码为 UTF-8 格式，解码得到的字符串中填充了空格：</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const textDecoder = new TextDecoder()

const encodedText = Uint32Array.of(102, 111, 111)
const decodedText = textDecoder.decode(encodedText)

console.log(decodedText) // &#x27;foo&#x27;</code>
        </deckgo-highlight-code><p>解码器是用于处理定型数组中分散在多个索引上的字符的，包括表情符号：</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const textDecoder = new TextDecoder()

const encodedText = Uint8Array.of(240, 159, 152, 138)
const decodedText = textDecoder.decode(encodedText)

console.log(decodedText) // &#x27;😊&#x27;</code>
        </deckgo-highlight-code><p>和<code>TextEncoder</code>不同，<code>TextDecoder</code>可以兼容很多字符编码。例如下面的例子就使用了 UTF-16 而非默认的 UTF-8:</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const textDecoder = new TextDecoder(&#x27;utf-16&#x27;)

const encodedText = Uint16Array.of(102, 111, 111)
const decodedText = textDecoder.decode(encodedText)

console.log(decodedText) // &#x27;foo&#x27;</code>
        </deckgo-highlight-code><h3>流解码</h3><p><code>TextDecoderStream</code>其实就是<code>TransformStream</code>形式的<code>TextDecoder</code>。将编码后的文本流通过管道输入流解码器会得到解码后的文本块的流：</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">async function* chars() {
  const encodedText = [102, 111, 111].map(x =&gt; Uint8Array.of(x))
  for (const char of encodedText) {
    yield await new Promise(resolve =&gt; setTimeout(resolve, 1000, char))
  }
}

const encodedTextStream = new ReadableStream({
  async start(controller) {
    for await (const chunk of chars()) {
      controller.enqueue(chunk)
    }

    controller.close()
  },
})

const decodedTextStream = encodedTextStream.pipeThrough(new TextDecoderStream())
const readableStreamDefaultReader = decodedTextStream.getReader()(
  async function () {
    while (true) {
      const { done, value } = await readableStreamDefaultReader.read()

      if (done) {
        break
      } else {
        console.log(value)
      }
    }
  }
)()

// f
// o
// o</code>
        </deckgo-highlight-code><p>文本解码器流能够识别可能分散在不同块上的代理对。解码器流会保持块片段直到取得完整的字符。例如在下面的例子中，流解码器在解码流并输出字符之前会等待传入 4 个块：</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">async function* chars() {
  const encodedText = [240, 159, 152, 138].map(x =&gt; Uint8Array.of(x))

  for (const char of encodedText) {
    yield await new Promise(resolve =&gt; setTimeout(resolve, 1000, char))
  }
}

const encodedTextStream = new ReadableStream({
  async start(controller) {
    for await (const chunk of chars()) {
      controller.enqueue(chunk)
    }
    controller.close()
  },
})

const decodedTextStream = encodedTextStream.pipeThrough(new TextDecoderStream())

const readableStreamDefaultReader = decodeTextStream.getReader()(
  async function () {
    while (true) {
      const { done, value } = await readableStreamDefaultReader.read()

      if (done) {
        break
      } else {
        console.log(value)
      }
    }
  }
)()

// &#x27;😊&#x27;</code>
        </deckgo-highlight-code><p>文本解码器流经常与<code>fetch()</code>一起使用，因为响应体可以作为<code>ReadableStream</code>来处理。例如：</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const response = await fetch(url)
const stream = response.body.pipeThrough(new TextDecoderStream())
const decodedStream = stream.getReader()

for await (const decodedChunk of decodedStream) {
  console.log(decodedChunk)
}</code>
        </deckgo-highlight-code><h1>File API 与 Blob API</h1><p>Web 应用程序的一个主要痛点是无法操作用户计算机上的文件。2000 年之前，处理文件的唯一方式是把<code>&lt;input type=&quot;file&quot;&gt;</code>放到一个表单里，仅此而已。File API 与 Blob API 是为了让 Web 开发者能以安全的方式访问客户端机器上的文件，从而更好地与这些文件交互而设计的。</p><h2><code>File</code>类型</h2><p><strong>File API 仍然以表单中的文件输入字段为基础</strong>，但是增加了直接访问文件信息的能力。HTML5 在 DOM 上为输入元素添加了<code>files</code>集合。当用户在文件字段中选择一个或多个文件时，这个<code>file</code>集合中会包含一组<code>File</code>对象，表示被选中的文件。每个<code>File</code>对象都有一些<strong>只读</strong>属性。</p><ul><li><code>name</code>：本地系统中的文件名</li><li><code>size</code>：以字节计算的文件大小</li><li><code>type</code>：包含文件 MIME 类型的字符串</li><li><code>lastModifiedDate</code>：表示文件最后修改事件的字符串。这个属性目前只有 Chrome 实现了。</li></ul><p>例如，通过监听<code>change</code>事件然后遍历<code>files</code>集合可以取得每个选中文件的信息：</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const fileList = document.getElementById(&#x27;files-list&#x27;)

filesList.addEventListener(&#x27;change&#x27;, event =&gt; {
  const files = event.target.files
  let i = 0
  while (i &lt; files.length) {
    const f = files[i]
    console.log(`${f.name}, ${f.type}, ${f.size} bytes`)
    i++
  }
})</code>
        </deckgo-highlight-code><p>这个例子简单将每个文件的信息输出到控制台。仅就这个能力而言，Web 应用已经比没有 File API 之前迈进了一大步。不过，File API 还提供了<code>FileReader</code>类型，让我们可以实际从文件中读取数据。</p><h2><code>FileReader</code>类型</h2><p><code>FileReader</code>类型表示一种异步文件读取机制。可以把<code>FileReader</code>想象成类似于<code>XMLHttpRequest</code>，只不过是用于从文件系统读取文件，而不是从服务器读取数据。<code>FileReader</code>类型提供了几个读取文件数据的方法。</p><ul><li><code>readAsText(file, encoding)</code>：从文件中读取纯文本内容并保存在<code>result</code>属性中。第二个参数表示编码，是可选的。</li><li><code>readAsDataURL(file)</code>：读取文件并将内容的数据 URI 保存在<code>result</code>属性中。</li><li><code>readAsBinaryString(file)</code>：读取文件并将每个字符的二进制数据保存在<code>result</code>属性中。</li><li><code>readAsArrayBuffer(file)</code>：读取文件并将文件内容以<code>ArrayBuffer</code>形式保存在<code>result</code>属性。</li></ul><p>这些读取数据的方法为处理文件数据提供了极大的灵活性。例如，为了向用户显示图片，可以将图片数据读取为 URI，而为了解析文件内容，可以将文件读取为文本。</p><p>因为这些读取方法是异步的，所以每个<code>FileReader</code>会发布几个事件，其中 3 个最有用的事件是<code>progress</code>、<code>error</code>和<code>load</code>，分别表示还有更多数据、发生了错误和读取完成。</p><p><code>progress</code>事件每 50 毫秒就会触发一次，和 XHR 的<code>progress</code>事件具有相同的信息：<code>lengthComputable</code>、<code>loaded</code>和<code>total</code>。此外，在<code>progress</code>事件中可以读取<code>FileReader</code>的<code>result</code>属性，即使其中尚未包含全部数据。</p><p><code>error</code>事件会在由于某种原因无法读取文件时触发。触发<code>error</code>事件时，<code>FileReader</code>的<code>error</code>属性会包含错误信息。这个属性是一个对象，只包含一个属性：<code>code</code>。这个错误码的值可能是 1（未找到文件）、2（安全错误）、3（读取被中断）、4（文件不可读）或 5（编码错误）。</p><p><code>load</code>事件会在文件加载成功后触发。如果<code>error</code>事件被触发，则不会再触发<code>load</code>事件。</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const filesList = document.getElementById(&#x27;files-list&#x27;) 

filesList.addEventListener(&#x27;change&#x27;, event =&gt; {
  const info = &quot;&quot;
  const output = document.getElementById(&#x27;output&#x27;)
  const progress = document.getElementById(&#x27;progress&#x27;)
  const files = event.target.files
  const type = &#x27;default&#x27;
  const reader = new FileReader()
  
  if (/image/.test(files[0].type)) {
    reader.readAsDataURL(files[0])
    type = &#x27;image&#x27;
  } else {
    reader.readAsText(files[0])
    type = &#x27;text&#x27;
  }
  
  reader.onerror = function() {
    output.innerHTML = &#x27;Could not read file, error code is &#x27; + reader.error.code
  }
  
  reader.onprogress = function(event) {
    if (event.lengthComputable) {
      progress.innerHTML = `${event.loaded}/${event.total}`
    }
  }
  
  reader.onload = function() {
    let html = &#x27;&#x27;
    
    switch(type) {
      case &#x27;image&#x27;:
        html = `&lt;img src=&quot;${reader.result}&quot;&gt;`
        break
      case &#x27;text&#x27;:
        html = reader.result
        break
    }
    output.innerHTML = html
  }
})</code>
        </deckgo-highlight-code><p>以上代码从表单字段中读取一个文件，并将其内容显示在了网页上。如果文件的MIME类型表示它是一个图片，那么就将其读取后保存为数据URL，在<code>load</code>事件触发时将数据URI作为图片插入页面中。如果文件不是图片，则读取后将其保存为文本并原样输出到网页上。<code>progress</code>事件用于跟踪和显示读取文件的进度，而<code>error</code>事件用于监控错误。</p><p>如果想提前结束文件读取，则可以在过程中调用<code>abort()</code>方法，从而触发<code>abort</code>事件。在<code>load</code>、<code>error</code>和<code>abort</code>事件触发后，还会触发<code>loadend</code>事件。<code>loadend</code>事件表示在上述3种情况下，所有读取操作都已结束。<code>readAsText()</code>和<code>readAsDataURL()</code>方法已经得到了所有主流浏览器支持。</p><h2><code>FileReaderSync</code>类型</h2><p>顾名思义，<code>FileReaderSync</code>类型就是<code>FileReader</code>的<strong>同步版本</strong>。这个类型拥有与<code>FileReader</code>相同的方法，只有在整个文件都加载到内存之后才会继续执行。<code>FileReaderSync</code>只在工作线程中可用，因为如果读取整个文件耗时太长则会影响全局。</p><p>假设通过<code>postMessage()</code>向工作线程发送了一个<code>File</code>对象。以下代码会让工作线程同步将文件读取到内存中，然后将文件的数据URL发送回来。</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">// worker.js

self.onmessage = messageEvent =&gt; {
  const syncReader = new FileReaderSync()
  console.log(syncReader) // FileReaderSync {}
  
  // 读取文件时阻塞工作线程
  const result = syncReader.readAsDataURL(messageEvent.data)
  
  // PDF文件的示例响应
  console.log(result) // data:application/pdf;base64,....
 	
  // 把URL发回去
  self.postMessage(result)
}</code>
        </deckgo-highlight-code><h2><code>Blob</code>与部分读取</h2><p>某些情况下，可能需要读取部分文件而不是整个文件。为此，<code>File</code>对象提供了一个名为<code>slice()</code>的方法。<code>slice()</code>方法接收两个参数：起始字节和要读取的字节数。这个方法返回一个<code>Blob</code>实例，而<code>Blob</code>实际上是<code>File</code>的基类。</p><p>Blob表示<strong>二进制大对象</strong>(binary large object)，是JavaScript对不可修改二进制数据的封装类型。包含字符串的数组、<code>ArrayBuffers</code>、<code>ArrayBufferViews</code>，甚至其他<code>Blob</code>都可以用来创建blob。<code>Blob</code>构造函数可以接受一个<code>options</code>参数，并在其中指定MIME类型：</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">console.log(new Blob([&#x27;foo&#x27;]))
// Blob {size: 3, type: &#x27;&#x27;}

console.log(new Blob([&#x27;{&quot;a&quot;, &quot;b&quot;}&#x27;], { type: &#x27;application/json&#x27; }))
// {size: 10, type: &quot;application/json&quot;}

console.log(new Blob([&#x27;&lt;p&gt;Foo&lt;/p&gt;&#x27;, &#x27;&lt;p&gt;Bar&lt;/p&gt;&#x27;], { type: &#x27;text/html&#x27; }))
// {size: 20, type: &#x27;text/html&#x27;}</code>
        </deckgo-highlight-code><p><code>Blob</code>对象有一个<code>size</code>属性和一个<code>type</code>属性，还有一个<code>slice()</code>方法用于进一步切分数据。另外也可以使用<code>FileReader</code>从<code>Blob</code>中读取数据。下面的例子只会读取文件的前32字节：</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const fileList = document.getElementById(&#x27;files-list&#x27;) 

filesList.addEventListener(&#x27;change&#x27;, event =&gt; {
  const info = &#x27;&#x27;
  const output = document.getElementById(&#x27;output&#x27;)
  const progress = document.getElementById(&#x27;progress&#x27;)
  const files = event.target.files
  const reader = new FileReader()
  const blob = blobSlice(files[0], 0, 32)
  
  if (blob) {
    reader.readAsText(blob)
    
    reader.onerror = function() {
      output.innerHTML = &#x27;Could not read file, error code is &#x27; + reader.error.code
    }
    
    reader.onload = function() {
      output.innerHTML = reader.result
    }
  } else {
    console.log(&#x27;You browser does not support slice()&#x27;)
  }
})</code>
        </deckgo-highlight-code><p>只读取部分文件可以节省时间，特别是只需要数据特定部分例如文件头部。</p><h2>对象URL和<code>Blob</code></h2><p>对象URL有时候也称为Blob URL，是指引用存储在<code>File</code>或<code>Blob</code>中数据的URL。对象URL的优点是不用把文件内容读取到JavaScript也可以使用文件。只要在适当位置提供对象URL即可。要创建对象URL，可以使用<code>window.URL.createObjectURL()</code>方法并传入<code>File</code>或<code>Blob</code>对象。这个函数返回的值是一个指向内存中地址的字符串。因为这个字符串是URL，所以可以在DOM中直接使用。例如下面的代码使用对象URL在页面中显示了一张图片：</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const filesList = document.getElementById(&#x27;files-list&#x27;)

filesList.addEventListener(&#x27;change&#x27;, event =&gt; {
  const info = &#x27;&#x27;
  const output = document.getElementById(&#x27;output&#x27;)
  const progress = document.getElementById(&#x27;progress&#x27;)
  const files = event.target.files
  const reader = new FileReader()
  const url = window.URL.createObjectURL(files[0])
  
  if (url) {
    if (/image/.test(files[0].type)) {
      output.innerHTML = `&lt;img src=&quot;${url}&quot;}&gt;`
    } else {
      output.innerHTML = &#x27;Not an image.&#x27;
    }
  } else {
    output.innerHTML = `Your browser doesn&#x27;t support object URLs.`
  }
})</code>
        </deckgo-highlight-code><p>如果把对象URL直接放到<code>&lt;img&gt;</code>标签，就不要把数据预先读取到JavaScript中了。<code>&lt;img&gt;</code>标签可以直接从相应的内存位置把数据读取到页面上。</p><p>使用完数据后，最好能释放与之关联的内存。只要对象URL在使用中，就不能释放内存。如果想表明不再使用某个对象URL，则可以将其传给<code>window.URL.revokeObjectURL()</code>。页面卸载时，所有对象URL占用的内存都会被释放。不过，最好在不使用时就会立即释放内存，以便尽可能保持页面占用最少资源。</p><h2>读取拖放文件</h2><p>组合使用HTML5拖放API和File API可以创建读取文件信息的有趣功能。在页面上创建放置目标后，可以从桌面上把文件拖动并放到放置目标。这样会像拖放图片或链接一样触发<code>drop</code>时间。被放置的文件可以通过时间的<code>event.dataTransfer.files</code>属性读取到，这个属性保存着一组<code>File</code>对象，就像文本输入字段一样。</p><p>下面的例子会把拖放到页面放置目标上的文件信息打印出来：</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const droptarget = document.getElementById(&#x27;droptarget&#x27;)

function handleEvent(event) {
  const info = &#x27;&#x27;
  const output = document.getElementById(&#x27;output&#x27;)
  let files, i, len
  event.preventDefault()
  
  if (event.type === &#x27;drop&#x27;) {
    files = event.dataTransfer.files
    i = 0
    len = files.length
    while (i &lt; len) {
      info += `${files[i].name} (${files[i].type}), ${files[i].size} bytes&lt;br&gt;`
      i++
    }
    
    output.innerHTML = info
  }
}

droptarget.addEventListener(&#x27;dragenter&#x27;, handleEvent)
droptarget.addEventListener(&#x27;dragover&#x27;, handleEvent) 
droptarget.addEventListener(&#x27;drop&#x27;, handleEvent)</code>
        </deckgo-highlight-code><p>与后面要介绍的拖放例子一样，必须取消<code>dragenter</code>、<code>dragover</code>和<code>drop</code>的默认行为。在<code>drop</code>事件处理程序中，可以通过<code>event.dataTransfer.files</code>读取到文件，此时可以获取文件的相关信息。</p><h1>媒体元素</h1><p>随着嵌入音频和视频元素在Web应用上的流行，大多数内容提供商会强迫使用Flash以便达到最佳的跨浏览器兼容性。HTML5新增了两个与媒体相关的元素，即<code>&lt;audio&gt;</code>和<code>&lt;video&gt;</code>，从而为浏览器提供了嵌入音频和视频的统一解决方案。</p><p>这两个元素既支持Web开发者在页面中嵌入媒体文件，也支持JavaScript实现对媒体的自定义控制。以下是它们的用法：</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">&lt;!-- 嵌入视频 --&gt; 
&lt;video src=&quot;conference.mpg&quot; id=&quot;myVideo&quot;&gt;Video player not available.&lt;/video&gt;
&lt;!-- 嵌入音频 --&gt; 
&lt;audio src=&quot;song.mp3&quot; id=&quot;myAudio&quot;&gt;Audio player not available.&lt;/audio&gt;</code>
        </deckgo-highlight-code><p>每个元素至少要求有一个<code>src</code>属性，以表示要加载的媒体文件。我们也可以指定表示视频播放器大小的<code>width</code>和<code>height</code>属性，以及在视屏加载期间显示图片URI的<code>poster</code>属性。另外，<code>controls</code>属性如果存在，则表示浏览器应该显示播放界面，让用户可以直接控制媒体。<strong>开始和结束标签之间的内容是在媒体播放器不可用时显示的替代内容</strong>。</p><p>由于浏览器支持的媒体格式不同，因此可以指定多个不同的媒体源。为此需要从元素中删除<code>src</code>属性，使用一个或多个<code>&lt;source&gt;</code>元素代替，例如下面的例子：</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">&lt;!-- 嵌入视频 --&gt; 
&lt;video id=&quot;myVideo&quot;&gt;
  &lt;source src=&quot;conference.webm&quot; type=&quot;video/webm; codecs=&#x27;vp8, vorbis&#x27;&quot; /&gt;
  &lt;source src=&quot;conference.ogv&quot; type=&quot;video/ogg; codecs=&#x27;theora, vorbis&#x27;&quot; /&gt;
  &lt;source src=&quot;conference.mpg&quot; /&gt;
  Video Player not available.
&lt;/video&gt;

&lt;!-- 嵌入音频 --&gt; 
&lt;audio id=&quot;myAudio&quot;&gt;
  &lt;source src=&quot;song.ogg&quot; type=&quot;audio/ogg&quot; /&gt;
  &lt;source src=&quot;song.mp3&quot; type=&quot;audio/mpeg&quot; /&gt;
  Audio Player not available.
&lt;/audio&gt;</code>
        </deckgo-highlight-code><p>讨论不同音频和视频的编解码器超出了本书范围，但浏览器支持的编解码器确实可能有所不同，因此指定多个源文件通常是必须的。</p><h2>属性</h2><p><code>&lt;video&gt;</code>和<code>&lt;audio&gt;</code>元素提供了稳健的JavaScript接口。这两个元素有很多共有属性，可以用于确定媒体的当前状态。</p><h2>事件</h2><p>除了有很多属性，媒体元素还有很多事件。这些事件会监控由于媒体回放或用户交互导致的不同属性的变化。这些事件被设计得尽可能具体，以便Web开发者能够使用较少的HTML和JavaScript创建自定义的音频/视频播放器（而不是创建新Flash影片）。</p><h2>自定义媒体播放器</h2><p>使用<code>&lt;audio&gt;</code>和<code>&lt;video&gt;</code>的<code>play()</code>和<code>pause()</code>方法，可以手动控制媒体文件的播放。综合使用属性、事件和这些方法，可以方便地创建自定义的媒体播放器。例如下面例子：</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">&lt;div class=&quot;mediaplayer&quot;&gt;
  &lt;div class=&quot;video&quot;&gt;
    &lt;video id=&quot;player&quot; src=&quot;movie.mov&quot; poster=&quot;mymovie.jpg&quot; width=&quot;300&quot; height=&quot;200&quot;&gt;
      Video player not available.
    &lt;/video&gt;
  &lt;/div&gt;
  &lt;div class=&quot;controls&quot;&gt;
    &lt;input type=&quot;button&quot; value=&quot;Play&quot; id=&quot;video-btn&quot; /&gt;
    &lt;span id=&quot;curtime&quot;&gt;0&lt;/span&gt;/&lt;span id=&quot;duration&quot;&gt;0&lt;/span&gt;
  &lt;/div&gt;
&lt;/div&gt;</code>
        </deckgo-highlight-code><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">const player = document.getElementById(&#x27;player&#x27;)
const btn = document.getElementById(&#x27;video-btn&#x27;)
const curtime = document.getElementById(&#x27;curtime&#x27;)
const duration = document.getElementById(&#x27;duration&#x27;)

duration.innerHTML = player.duration

btn.addEventListener(&#x27;click&#x27;, event =&gt; {
  if (player.paused) {
    player.play()
    btn.value = &#x27;Pause&#x27;
  } else {
    player.pause()
    btn.value = &#x27;Play&#x27;
  }
})

setInterval(() =&gt; {
  curTime.innerHTML = player.currentTime
}, 250)</code>
        </deckgo-highlight-code><p>这里的JavaScript代码简单地为按钮添加了事件处理程序，可以根据当前状态播放和暂停视频。此外，还给<code>&lt;video&gt;</code>元素的<code>load</code>事件添加了事件处理程序，以便显示视频的时长。最后重复的计时器用于更新当前时间。通过监听更多事件以及使用更多属性，可以进一步扩展这个自定义的视频播放器。同样的代码也可以用于<code>&lt;audio&gt;</code>元素以创建自定义的音频播放器。</p><h2>检测编解码器</h2><p>如前所述，并不是所有浏览器都支持<code>&lt;video&gt;</code>和<code>&lt;audio&gt;</code>的所有编解码器，这通常意味着必须提供多个媒体源。为此，也有JavaScript API可以用来检测浏览器是否支持给定格式和编解码器。这两个媒体元素都有一个名为<code>canPlayType()</code>的方法，改方法接收一个格式/编解码器字符串，返回一个字符串值：<code>&quot;probably&quot;</code>、<code>&quot;maybe&quot;</code>或<code>&quot;&quot;</code>（空字符串），其中空字符串就是假值，意味着可以在<code>if</code>语句中像这样使用<code>canPlayType()</code>:</p><deckgo-highlight-code language="javascript" theme="one-dark">
          <code slot="code">if (audio.canPlayType(&#x27;audio/mpeg&#x27;)) {
  // 执行某些操作
}</code>
        </deckgo-highlight-code><p><code>&quot;probably&quot;</code>和<code>&quot;maybe&quot;</code>都是真值，在<code>if</code>语句的上下文中可以转型为<code>true</code>。</p><p>在只给<code>canPlayType()</code>提供一个MIME类型的情况下，最可能返回的值是<code>&quot;maybe&quot;</code>和空字符串。这是因为文件实际上只是一个包装音频和视频数据的容器，而真正决定文件是否可以播放的是编码。在同时提供MIME类型和编解码器的情况下，返回值的可能性会提高到<code>probably</code>。</p><h2>音频类型</h2><p><code>&lt;audio&gt;</code>元素还有一个名为<code>Audio</code>的原生JavaScript构造函数，支持在任何时候播放音频。<code>Audio</code>类型和<code>Image</code>类似，都是DOM元素的对等体，只是不需插入文档即可工作。要通过<code>Audio</code>播放音频，只需创建一个新实例并传入音频源文件：</p><deckgo-highlight-code language="jsx" theme="one-dark">
          <code slot="code">const audio = new Audio(&#x27;sound.mp3&#x27;)
EventUtil.addHandler(audio, &#x27;canplaythrough&#x27;, function(event) {
  audio.play()
})</code>
        </deckgo-highlight-code><p>创建<code>Audio</code>的新实例就会下载指定的文件。下载完毕之后，可以调用<code>play()</code>来播放音频。在iOS中调用<code>play()</code>方法会弹出一个对话框，请求用户授权播放声音。为了连续播放，必须在<code>onfinish</code>事件处理程序中立即调用<code>play()</code>。</p></div><div class="navigator-switch" style="display:none"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="list" class="svg-inline--fa fa-list " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M88 48C101.3 48 112 58.75 112 72V120C112 133.3 101.3 144 88 144H40C26.75 144 16 133.3 16 120V72C16 58.75 26.75 48 40 48H88zM480 64C497.7 64 512 78.33 512 96C512 113.7 497.7 128 480 128H192C174.3 128 160 113.7 160 96C160 78.33 174.3 64 192 64H480zM480 224C497.7 224 512 238.3 512 256C512 273.7 497.7 288 480 288H192C174.3 288 160 273.7 160 256C160 238.3 174.3 224 192 224H480zM480 384C497.7 384 512 398.3 512 416C512 433.7 497.7 448 480 448H192C174.3 448 160 433.7 160 416C160 398.3 174.3 384 192 384H480zM16 232C16 218.7 26.75 208 40 208H88C101.3 208 112 218.7 112 232V280C112 293.3 101.3 304 88 304H40C26.75 304 16 293.3 16 280V232zM88 368C101.3 368 112 378.7 112 392V440C112 453.3 101.3 464 88 464H40C26.75 464 16 453.3 16 440V392C16 378.7 26.75 368 40 368H88z"></path></svg></div><div class="article-navigator" style="display:block"><div class="article-navigator-toggler"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="xmark" class="svg-inline--fa fa-xmark " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"></path></svg></div><h4>前端杂谈</h4><p title="跨源资源共享（CORS）" class="">跨源资源共享（CORS）</p><p title="渲染页面：浏览器的工作原理" class="">渲染页面：浏览器的工作原理</p><p title="React diffing算法" class="">React diffing算法</p><p title="Vercel简介 静态博客部署" class="">Vercel简介 静态博客部署</p><h4>抄书系列——《算法导论》</h4><p title="算法导论系列（一）翻开《算法导论》" class="">算法导论系列（一）翻开《算法导论》</p><p title="算法导论系列（二）算法在计算中的作用" class="">算法导论系列（二）算法在计算中的作用</p><h4>抄书系列——“红宝书”</h4><p title="红宝书系列（一）什么是JavaScript？" class="">红宝书系列（一）什么是JavaScript？</p><p title="红宝书系列（二）HTML中的JavaScript" class="">红宝书系列（二）HTML中的JavaScript</p><p title="红宝书系列（三）JavaScript语言基础" class="">红宝书系列（三）JavaScript语言基础</p><p title="红宝书系列（六）集合引用类型" class="">红宝书系列（六）集合引用类型</p><p title="红宝书系列（七）迭代器与生成器" class="">红宝书系列（七）迭代器与生成器</p><p title="红宝书系列（十一）期约与异步函数" class="">红宝书系列（十一）期约与异步函数</p><p title="红宝书系列（十四）DOM" class="">红宝书系列（十四）DOM</p><p title="红宝书系列（十五）DOM扩展" class="">红宝书系列（十五）DOM扩展</p><p title="红宝书系列（十七）事件" class="">红宝书系列（十七）事件</p><p title="红宝书系列（二十）JavaScript API" class="highlighted-navigator-item">红宝书系列（二十）JavaScript API</p></div>0</main><footer class="footer"><div class="wrapper"><p style="font-size:1.3rem"><span><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="weixin" class="svg-inline--fa fa-weixin " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentColor" d="M385.2 167.6c6.4 0 12.6 .3 18.8 1.1C387.4 90.3 303.3 32 207.7 32 100.5 32 13 104.8 13 197.4c0 53.4 29.3 97.5 77.9 131.6l-19.3 58.6 68-34.1c24.4 4.8 43.8 9.7 68.2 9.7 6.2 0 12.1-.3 18.3-.8-4-12.9-6.2-26.6-6.2-40.8-.1-84.9 72.9-154 165.3-154zm-104.5-52.9c14.5 0 24.2 9.7 24.2 24.4 0 14.5-9.7 24.2-24.2 24.2-14.8 0-29.3-9.7-29.3-24.2 .1-14.7 14.6-24.4 29.3-24.4zm-136.4 48.6c-14.5 0-29.3-9.7-29.3-24.2 0-14.8 14.8-24.4 29.3-24.4 14.8 0 24.4 9.7 24.4 24.4 0 14.6-9.6 24.2-24.4 24.2zM563 319.4c0-77.9-77.9-141.3-165.4-141.3-92.7 0-165.4 63.4-165.4 141.3S305 460.7 397.6 460.7c19.3 0 38.9-5.1 58.6-9.9l53.4 29.3-14.8-48.6C534 402.1 563 363.2 563 319.4zm-219.1-24.5c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.8 0 24.4 9.7 24.4 19.3 0 10-9.7 19.6-24.4 19.6zm107.1 0c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.5 0 24.4 9.7 24.4 19.3 .1 10-9.9 19.6-24.4 19.6z"></path></svg></span><span><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="qq" class="svg-inline--fa fa-qq " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M433.8 420.4c-11.53 1.393-44.86-52.74-44.86-52.74 0 31.34-16.14 72.25-51.05 101.8 16.84 5.192 54.84 19.17 45.8 34.42-7.316 12.34-125.5 7.881-159.6 4.037-34.12 3.844-152.3 8.306-159.6-4.037-9.045-15.25 28.92-29.21 45.78-34.42-34.92-29.54-51.06-70.44-51.06-101.8 0 0-33.33 54.13-44.86 52.74-5.37-.65-12.42-29.64 9.347-99.7 10.26-33.02 21.1-60.48 40.14-105.8C60.68 98.06 108.1 .006 224 0c113.7 .006 163.2 96.13 160.3 214.1 18.12 45.22 29.91 72.85 40.14 105.8 21.77 70.06 14.72 99.05 9.346 99.7z"></path></svg></span><span><a href="mailto:k1664032884@gmail.com"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="envelope" class="svg-inline--fa fa-envelope " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 352c-16.53 0-33.06-5.422-47.16-16.41L0 173.2V400C0 426.5 21.49 448 48 448h416c26.51 0 48-21.49 48-48V173.2l-208.8 162.5C289.1 346.6 272.5 352 256 352zM16.29 145.3l212.2 165.1c16.19 12.6 38.87 12.6 55.06 0l212.2-165.1C505.1 137.3 512 125 512 112C512 85.49 490.5 64 464 64h-416C21.49 64 0 85.49 0 112C0 125 6.01 137.3 16.29 145.3z"></path></svg></a></span><span><a href="https://github.com/kqhasaki" target="_blank" rel="noreferrer"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3 .3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5 .3-6.2 2.3zm44.2-1.7c-2.9 .7-4.9 2.6-4.6 4.9 .3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3 .7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3 .3 2.9 2.3 3.9 1.6 1 3.6 .7 4.3-.7 .7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3 .7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3 .7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a></span><span><a href="/static/resume-ef27ab676ea536646634203d2696b372.pdf" download="resume.pdf" title="简历下载"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="file" class="svg-inline--fa fa-file " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="currentColor" d="M256 0v128h128L256 0zM224 128L224 0H48C21.49 0 0 21.49 0 48v416C0 490.5 21.49 512 48 512h288c26.51 0 48-21.49 48-48V160h-127.1C238.3 160 224 145.7 224 128z"></path></svg></a></span><span><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="sun" class="svg-inline--fa fa-sun " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"></path></svg></span></p><p>CopyRight © 2022 Louis K</p></div><div class="wrapper" style="align-items:flex-end"><h3>Links</h3><ul><li><span><a href="https://reactjs.org/" rel="noreferrer" target="_blank">React</a></span></li><li><span><a href="https://developer.mozilla.org/zh-CN/" rel="noreferrer" target="_blank">MDN</a></span></li><li><span><a href="https://leafletjs.com/reference.html" rel="noreferrer" target="_blank">Leaflet</a></span></li><li><span><a href="https://ant.design/index-cn" rel="noreferrer" target="_blank">Ant Design</a></span></li><li><span><a href="https://webpack.docschina.org/concepts/" rel="noreferrer" target="_blank">webpack</a></span></li></ul></div></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/articles/redbook-series/redbook-chapter20/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-a6a9e8476add1045c345.js"],"app":["/app-e932af7f93db5f1d5fc7.js"],"component---src-pages-404-js":["/component---src-pages-404-js-0596c1b54a96191bcb2c.js"],"component---src-pages-articles-mdx-slug-js":["/component---src-pages-articles-mdx-slug-js-9153719145713b5d4a70.js"],"component---src-pages-index-js":["/component---src-pages-index-js-d1c8fd647f7227c1623c.js"],"component---src-pages-non-tech-js":["/component---src-pages-non-tech-js-f008706b4b33f800b86e.js"]};/*]]>*/</script><script src="/polyfill-a6a9e8476add1045c345.js" nomodule=""></script><script src="/component---src-pages-articles-mdx-slug-js-9153719145713b5d4a70.js" async=""></script><script src="/commons-9cb01ae01e0bbefcc23a.js" async=""></script><script src="/a9a7754c-992c6b2080a7db331a45.js" async=""></script><script src="/cb1608f2-31c90b1bb67e245cb538.js" async=""></script><script src="/app-e932af7f93db5f1d5fc7.js" async=""></script><script src="/framework-f27b074ecebec0f1dbc4.js" async=""></script><script src="/webpack-runtime-2728ac9e468d19f28ba9.js" async=""></script></body></html>